{% extends "base.html" %}
{% block content %}

<div class="max-w-7xl mx-auto space-y-14">

    <!-- HEADER -->
    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-6">
        <div>
            <h1 class="text-3xl font-bold">Admin Dashboard</h1>
            <p class="text-gray-400 text-sm mt-1">ภาพรวมระบบและยอดขาย</p>
        </div>

        <div class="flex gap-3">
            <a href="{{ url_for('admin.export_pdf') }}"
               class="btn bg-red-600 hover:bg-red-500 border-none">
                PDF
            </a>
            <a href="{{ url_for('admin.export_excel') }}"
               class="btn bg-green-600 hover:bg-green-500 border-none">
                Excel
            </a>
        </div>
    </div>


    <!-- KPI GRID -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">

        {% set kpis = [
            ("ยอดขายรวม", total_sales ~ " บาท", "from-purple-600 to-indigo-600"),
            ("Paid Revenue", paid_revenue ~ " บาท", "from-green-500 to-emerald-600"),
            ("Average Order", avg_order ~ " บาท", "from-cyan-500 to-blue-600"),
            ("Conversion Rate", conversion_rate ~ " %", "from-yellow-500 to-orange-500")
        ] %}

        {% for title, value, gradient in kpis %}
        <div class="p-6 rounded-2xl shadow-xl bg-gradient-to-r {{ gradient }}
                    transition duration-300 hover:scale-105 hover:shadow-2xl">
            <p class="text-sm text-gray-200">{{ title }}</p>
            <h2 class="text-2xl font-bold mt-2">{{ value }}</h2>
        </div>
        {% endfor %}

    </div>


    <!-- CHART SECTION -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

        <div class="bg-black/60 p-8 rounded-2xl border border-gray-800 shadow-xl">
            <h3 class="text-lg font-semibold mb-6">Monthly Revenue</h3>
            <canvas id="monthlyChart"></canvas>
        </div>

        <div class="bg-black/60 p-8 rounded-2xl border border-gray-800 shadow-xl">
            <h3 class="text-lg font-semibold mb-6">Order Status Distribution</h3>
            <canvas id="statusChart"></canvas>
        </div>

    </div>


    <!-- ORDER SECTION -->
    <div class="bg-black/60 p-8 rounded-2xl border border-gray-800 shadow-xl space-y-8">

        <!-- TITLE + FILTER -->
        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-6">

            <h3 class="text-xl font-semibold">รายการคำสั่งซื้อ</h3>

            <div class="flex flex-wrap gap-4">

                <select class="select bg-black border-gray-700">
                    <option>ทุกสถานะ</option>
                    <option>Pending</option>
                    <option>Paid</option>
                    <option>Cancelled</option>
                </select>

                <input type="date" class="input bg-black border-gray-700">
                <input type="date" class="input bg-black border-gray-700">

                <button class="btn bg-cyan-500 hover:bg-cyan-400 border-none text-black">
                    กรอง
                </button>

            </div>

        </div>


        <!-- TABLE -->
        <div class="overflow-x-auto rounded-xl border border-gray-800">
            <table class="table text-white">

                <thead class="bg-gray-900 text-gray-400 uppercase text-sm">
                    <tr>
                        <th>#</th>
                        <th>ยอดรวม</th>
                        <th>วันที่</th>
                        <th>สถานะ</th>
                    </tr>
                </thead>

                <tbody>

                    {% for order in orders %}
                    <tr class="hover:bg-gray-900 transition">
                        <td>#{{ order.id }}</td>
                        <td class="font-semibold">{{ order.total_amount }}</td>
                        <td>{{ order.created_at.strftime("%d/%m/%Y") }}</td>
                        <td>
                            {% if order.status == "Paid" %}
                                <span class="badge bg-green-600 border-none">Paid</span>
                            {% elif order.status == "Pending" %}
                                <span class="badge bg-yellow-500 text-black border-none">Pending</span>
                            {% else %}
                                <span class="badge bg-red-600 border-none">Cancelled</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}

                </tbody>

            </table>
        </div>

    </div>

</div>

{% endblock %}