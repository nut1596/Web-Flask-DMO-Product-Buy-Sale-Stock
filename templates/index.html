{% extends "base.html" %}
{% block content %}

<!-- HERO -->
<div class="text-center mb-16">

    <div class="w-32 h-32 mx-auto mb-8 rounded-full border-4 border-cyan-500 animate-pulse"></div>

    <h1 class="text-5xl font-extrabold mb-4 bg-gradient-to-r from-cyan-400 via-purple-500 to-pink-500 bg-clip-text text-transparent">
        DMO Stock System
    </h1>

    <p class="text-gray-400 text-lg">
        ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á DMO! ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
    </p>

</div>


<!-- FILTER PANEL -->
<div class="max-w-5xl mx-auto mb-16">

    <form method="GET"
          class="bg-white/5 backdrop-blur-xl border border-gray-800 rounded-2xl p-6 grid md:grid-cols-4 gap-4 shadow-xl">

        <input type="text"
               name="search"
               value="{{ search or '' }}"
               placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."
               class="input bg-black/40 border-gray-700 focus:border-cyan-500 w-full" />

        <select name="category"
                class="select bg-black/40 border-gray-700 focus:border-purple-500 w-full">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
            {% for c in categories %}
            <option value="{{ c.id }}"
                {% if selected_category and selected_category|int == c.id %}
                    selected
                {% endif %}>
                {{ c.name }}
            </option>
            {% endfor %}
        </select>

        <select name="sort"
                class="select bg-black/40 border-gray-700 focus:border-pink-500 w-full">
            <option value="">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥</option>
            <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>
                ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥ ‚Üí ‡∏™‡∏π‡∏á
            </option>
            <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>
                ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á ‚Üí ‡∏ï‡πà‡∏≥
            </option>
        </select>

        <button class="btn bg-gradient-to-r from-cyan-500 to-purple-600 border-none text-white hover:opacity-90">
            ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        </button>

    </form>

</div>


<!-- PRODUCT GRID -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-10">

    {% for product in products %}
    <div class="card glow-card bg-black/60 border border-gray-800 rounded-2xl">

        <figure>
            <img src="{{ url_for('static', filename='images/' + product.image) }}"
                 class="h-52 w-full object-cover rounded-t-2xl">
        </figure>

        <div class="card-body">

            <h2 class="card-title text-white">
                {{ product.name }}
            </h2>

            <p class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                {{ product.price }} ‡∏ö‡∏≤‡∏ó
            </p>

            <!-- STOCK -->
            {% if product.stock == 0 %}
                <div class="badge bg-red-600 border-none">
                    ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î
                </div>
            {% elif product.stock <= 3 %}
                <div class="badge bg-yellow-500 text-black border-none">
                    ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ {{ product.stock }} ‡∏ä‡∏¥‡πâ‡∏ô
                </div>
            {% else %}
                <div class="badge bg-green-600 border-none">
                    ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢
                </div>
            {% endif %}

            <!-- BUTTON -->
            <div class="card-actions justify-end mt-4">
                {% if product.stock > 0 %}
                    <button onclick="addToCart({{ product.id }})"
                        class="btn btn-success btn-sm">
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                    </button>
                {% else %}
                    <button class="btn btn-disabled btn-sm">
                        ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß
                    </button>
                {% endif %}
            </div>

        </div>
    </div>
    {% endfor %}

</div>


<!-- PAGINATION -->
{% if pagination.pages > 1 %}
<div class="flex justify-center mt-16">
    <div class="join">

        {% if pagination.has_prev %}
        <a class="join-item btn bg-gray-800 hover:bg-gray-700"
           href="{{ url_for('main.home',
                            page=pagination.prev_num,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           ¬´
        </a>
        {% endif %}

        {% for p in range(1, pagination.pages + 1) %}
        <a class="join-item btn
           {% if p == pagination.page %}
              bg-gradient-to-r from-cyan-500 to-purple-600 text-white
           {% else %}
              bg-gray-800 hover:bg-gray-700
           {% endif %}"
           href="{{ url_for('main.home',
                            page=p,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           {{ p }}
        </a>
        {% endfor %}

        {% if pagination.has_next %}
        <a class="join-item btn bg-gray-800 hover:bg-gray-700"
           href="{{ url_for('main.home',
                            page=pagination.next_num,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           ¬ª
        </a>
        {% endif %}

    </div>
</div>
{% endif %}

<script>
function addToCart(productId) {

    fetch(`/add_to_cart/${productId}`, {
        method: "POST"
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
            document.getElementById("cart-count").innerText = data.cart_count;

            // üéØ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° Cart ‡πÄ‡∏î‡πâ‡∏á
            const cartBtn = document.getElementById("cart-button");
            cartBtn.classList.add("animate-bounce");

            setTimeout(() => {
                cartBtn.classList.remove("animate-bounce");
            }, 600);

            showToast("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß üõí");
        }
    });
}

function showToast(message) {

    const toast = document.createElement("div");
    toast.className =
        "fixed bottom-5 right-5 bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg z-50";

    toast.innerText = message;

    document.body.appendChild(toast);

    setTimeout(() => {
        toast.remove();
    }, 2000);
}
</script>

    

{% endblock %}