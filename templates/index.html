{% extends "base.html" %}
{% block content %}

<!-- HERO -->
<div class="text-center mb-16">

    <div class="w-32 h-32 mx-auto mb-8 rounded-full border-4 border-cyan-500 animate-pulse"></div>

    <h1 class="text-5xl font-extrabold mb-4 bg-gradient-to-r from-cyan-400 via-purple-500 to-pink-500 bg-clip-text text-transparent">
        DMO Stock System
    </h1>

    <p class="text-gray-400 text-lg">
        ระบบจัดการการ์ดสไตล์ AI Startup
    </p>

</div>


<!-- FILTER PANEL -->
<div class="max-w-5xl mx-auto mb-16">

    <form method="GET"
          class="bg-white/5 backdrop-blur-xl border border-gray-800 rounded-2xl p-6 grid md:grid-cols-4 gap-4 shadow-xl">

        <input type="text"
               name="search"
               value="{{ search or '' }}"
               placeholder="ค้นหาสินค้า..."
               class="input bg-black/40 border-gray-700 focus:border-cyan-500 w-full" />

        <select name="category"
                class="select bg-black/40 border-gray-700 focus:border-purple-500 w-full">
            <option value="">ทุกหมวดหมู่</option>
            {% for c in categories %}
            <option value="{{ c.id }}"
                {% if selected_category and selected_category|int == c.id %}
                    selected
                {% endif %}>
                {{ c.name }}
            </option>
            {% endfor %}
        </select>

        <select name="sort"
                class="select bg-black/40 border-gray-700 focus:border-pink-500 w-full">
            <option value="">เรียงตามปกติ</option>
            <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>
                ราคาต่ำ → สูง
            </option>
            <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>
                ราคาสูง → ต่ำ
            </option>
        </select>

        <button class="btn bg-gradient-to-r from-cyan-500 to-purple-600 border-none text-white hover:opacity-90">
            ค้นหา
        </button>

    </form>

</div>


<!-- PRODUCT GRID -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-10">

    {% for product in products %}
    <div class="card glow-card bg-black/60 border border-gray-800 rounded-2xl">

        <figure>
            <img src="{{ url_for('static', filename='images/' + product.image) }}"
                 class="h-52 w-full object-cover rounded-t-2xl">
        </figure>

        <div class="card-body">

            <h2 class="card-title text-white">
                {{ product.name }}
            </h2>

            <p class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">
                {{ product.price }} บาท
            </p>

            <!-- STOCK -->
            {% if product.stock == 0 %}
                <div class="badge bg-red-600 border-none">
                    สินค้าหมด
                </div>
            {% elif product.stock <= 3 %}
                <div class="badge bg-yellow-500 text-black border-none">
                    เหลือ {{ product.stock }} ชิ้น
                </div>
            {% else %}
                <div class="badge bg-green-600 border-none">
                    พร้อมจำหน่าย
                </div>
            {% endif %}

            <!-- BUTTON -->
            <div class="card-actions justify-end mt-4">
                {% if product.stock > 0 %}
                    <a href="{{ url_for('main.add_to_cart', product_id=product.id) }}"
                       class="btn bg-purple-600 hover:bg-purple-500 border-none btn-sm">
                        เพิ่มลงตะกร้า
                    </a>
                {% else %}
                    <button class="btn btn-disabled btn-sm">
                        หมดแล้ว
                    </button>
                {% endif %}
            </div>

        </div>
    </div>
    {% endfor %}

</div>


<!-- PAGINATION -->
{% if pagination.pages > 1 %}
<div class="flex justify-center mt-16">
    <div class="join">

        {% if pagination.has_prev %}
        <a class="join-item btn bg-gray-800 hover:bg-gray-700"
           href="{{ url_for('main.home',
                            page=pagination.prev_num,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           «
        </a>
        {% endif %}

        {% for p in range(1, pagination.pages + 1) %}
        <a class="join-item btn
           {% if p == pagination.page %}
              bg-gradient-to-r from-cyan-500 to-purple-600 text-white
           {% else %}
              bg-gray-800 hover:bg-gray-700
           {% endif %}"
           href="{{ url_for('main.home',
                            page=p,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           {{ p }}
        </a>
        {% endfor %}

        {% if pagination.has_next %}
        <a class="join-item btn bg-gray-800 hover:bg-gray-700"
           href="{{ url_for('main.home',
                            page=pagination.next_num,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           »
        </a>
        {% endif %}

    </div>
</div>
{% endif %}

{% endblock %}