{% extends "base.html" %}

{% block content %}

<h2 class="text-3xl font-bold text-center mb-8">
    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πå‡∏î
</h2>

<!-- üîç SEARCH / FILTER -->
<form method="GET" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">

    <input type="text"
           name="search"
           value="{{ search or '' }}"
           placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."
           class="input input-bordered w-full" />

    <select name="category" class="select select-bordered w-full">
        <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
        {% for c in categories %}
        <option value="{{ c.id }}"
            {% if selected_category and selected_category|int == c.id %}
                selected
            {% endif %}>
            {{ c.name }}
        </option>
        {% endfor %}
    </select>

    <select name="sort" class="select select-bordered w-full">
        <option value="">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥</option>
        <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>
            ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥ ‚Üí ‡∏™‡∏π‡∏á
        </option>
        <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>
            ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á ‚Üí ‡∏ï‡πà‡∏≥
        </option>
    </select>

    <button class="btn btn-primary w-full">
        ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    </button>

</form>


<!-- üõç PRODUCT GRID -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">

    {% for product in products %}
    <div class="card bg-base-100 shadow-xl">

        <figure>
            <img src="{{ url_for('static', filename='images/' + product.image) }}"
                 class="h-48 w-full object-cover">
        </figure>

        <div class="card-body">

            <h2 class="card-title">
                {{ product.name }}
            </h2>

            <p class="text-lg font-bold text-primary">
                {{ product.price }} ‡∏ö‡∏≤‡∏ó
            </p>

            <!-- üì¶ STOCK STATUS -->
            {% if product.stock == 0 %}
                <div class="badge badge-error">
                    ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î
                </div>
            {% elif product.stock <= 3 %}
                <div class="badge badge-warning">
                    ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ {{ product.stock }} ‡∏ä‡∏¥‡πâ‡∏ô
                </div>
            {% else %}
                <div class="badge badge-success">
                    ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢
                </div>
            {% endif %}

            <!-- üõí BUTTON -->
            <div class="card-actions justify-end mt-3">
                {% if product.stock > 0 %}
                    <a href="{{ url_for('main.add_to_cart', product_id=product.id) }}"
                       class="btn btn-success btn-sm">
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                    </a>
                {% else %}
                    <button class="btn btn-disabled btn-sm">
                        ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß
                    </button>
                {% endif %}
            </div>

        </div>
    </div>
    {% endfor %}

</div>


<!-- üìÑ PAGINATION -->
{% if pagination.pages > 1 %}
<div class="flex justify-center mt-10">
    <div class="join">

        {% if pagination.has_prev %}
        <a class="join-item btn"
           href="{{ url_for('main.home',
                            page=pagination.prev_num,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           ¬´
        </a>
        {% endif %}

        {% for p in range(1, pagination.pages + 1) %}
        <a class="join-item btn {% if p == pagination.page %}btn-active{% endif %}"
           href="{{ url_for('main.home',
                            page=p,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           {{ p }}
        </a>
        {% endfor %}

        {% if pagination.has_next %}
        <a class="join-item btn"
           href="{{ url_for('main.home',
                            page=pagination.next_num,
                            search=search,
                            category=selected_category,
                            sort=sort) }}">
           ¬ª
        </a>
        {% endif %}

    </div>
</div>
{% endif %}

{% endblock %}