{% extends "base.html" %}

{% block content %}
<h2 class="mb-4 text-center">เลือกสายการ์ด</h2>


<form method="GET" class="row mb-4">

    <div class="col-md-4">
        <input type="text"
               name="search"
               value="{{ search or '' }}"
               class="form-control"
               placeholder="ค้นหาสินค้า...">
    </div>

    <div class="col-md-4">
        <select name="category" class="form-control">
            <option value="">ทุกหมวดหมู่</option>
            {% for c in categories %}
            <option value="{{ c.id }}"
                {% if selected_category and selected_category|int == c.id %}
                    selected
                {% endif %}
            >
                {{ c.name }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-4">
        <select name="sort" class="form-control">
            <option value="">เรียงตามปกติ</option>
            <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>
                ราคาต่ำ → สูง
            </option>
            <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>
                ราคาสูง → ต่ำ
            </option>
        </select>
    </div>

    <div class="col-md-4">
        <button class="btn btn-primary w-100">
            ค้นหา
        </button>
    </div>

</form>


<div class="row">
    {% for product in products %}
    <div class="col-md-3 mb-4">
        <div class="card shadow-sm text-center">
            <img src="{{ url_for('static', filename='images/' + product.image) }}"
                 class="card-img-top"
                 style="height:200px; object-fit:cover;">

            <div class="card-body">
                <h6>{{ product.name }}</h6>
                <p>{{ product.price }} บาท</p>

                {% if product.stock == 0 %}
                    <span class="badge bg-danger">สินค้าหมด</span>
                {% elif product.stock <= 3 %}
                    <span class="badge bg-warning text-dark">
                        เหลือ {{ product.stock }} ชิ้น
                    </span>
                {% endif %}

                {% if product.stock > 0 %}
                    <a href="{{ url_for('main.add_to_cart', product_id=product.id) }}"
                    class="btn btn-success btn-sm mt-2">
                    เพิ่มลงตะกร้า
                </a>
                {% else %}
                <button class="btn btn-secondary btn-sm mt-2" disabled>
                    หมดแล้ว
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>


{% if pagination.pages > 1 %}
<nav>
    <ul class="pagination justify-content-center">

        {% if pagination.has_prev %}
        <li class="page-item">
            <a class="page-link"
               href="{{ url_for('main.home',
                                page=pagination.prev_num,
                                search=search,
                                category=selected_category,
                                sort=sort) }}">
               Previous
            </a>
        </li>
        {% endif %}

        {% for p in range(1, pagination.pages + 1) %}
        <li class="page-item {% if p == pagination.page %}active{% endif %}">
            <a class="page-link"
               href="{{ url_for('main.home',
                                page=p,
                                search=search,
                                category=selected_category,
                                sort=sort) }}">
               {{ p }}
            </a>
        </li>
        {% endfor %}

        {% if pagination.has_next %}
        <li class="page-item">
            <a class="page-link"
               href="{{ url_for('main.home',
                                page=pagination.next_num,
                                search=search,
                                category=selected_category,
                                sort=sort) }}">
               Next
            </a>
        </li>
        {% endif %}

    </ul>
</nav>
{% endif %}


{% endblock %}